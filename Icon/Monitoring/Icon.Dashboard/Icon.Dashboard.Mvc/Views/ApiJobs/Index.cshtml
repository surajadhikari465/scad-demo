@model Icon.Dashboard.Mvc.ViewModels.ApiMessageJobReportViewModel

@{
    var globalViewData = ViewBag.GlobalViewData as Icon.Dashboard.Mvc.ViewModels.GlobalViewData;
    Icon.Dashboard.Mvc.ViewModels.ApiMessageJobTimedReportViewModel jobReportModel = null;
    if (Model.JobType != null)
    {
        jobReportModel = new Icon.Dashboard.Mvc.ViewModels.ApiMessageJobTimedReportViewModel(Model.JobType);
    }
    var jobStart = (jobReportModel == null) ? String.Empty : jobReportModel.StartTime.Value.ToString("YYYY-MM-DD HH:mm:ss");
    var jobEnd = (jobReportModel == null) ? String.Empty : jobReportModel.EndTime.Value.ToString("YYYY-MM-DD HH:mm:ss");
}
<p></p>

<div class="container-wide">
    @{ Html.RenderPartial("_ApiJobsReportPartial", Model); }
</div>

<div id="pagingDiv">
    @if (ViewBag.PaginationPageSetViewModel != null && Model.PaginationModel is Icon.Dashboard.Mvc.ViewModels.PaginationPageSetViewModel)
    {
        <div>
            @{Html.RenderPartial("_PaginationPartial", Model.PaginationModel as Icon.Dashboard.Mvc.ViewModels.PaginationPageSetViewModel);}
        </div>
    }
</div>

@if (ViewBag.JobType != null)
{
    <div id="reportDiv" class="container">
        @{
            Html.RenderPartial("_ApiMessageJobTimedReportPartial", jobReportModel);
        }
    </div>
}

@section scripts {
    <script type="text/javascript">
        function summarizeFailed(ajaxContext) {
            var message = "The summarize report request failed with status " + ajaxContext.status + ": " + ajaxContext.statusText;
            if (typeof console !== "undefined") console.log(message);
            $('#errorPanel').removeClass('hidden').show();
            $('#errorPanelContent').text(message);
        }

        @* javascript data set from server-side Razor code for ApiJobs view*@
        $(function () {
            $('#@("StartTime")').datetimepicker({
                defaultDate: '@jobStart',
                format: 'YYYY-MM-DD HH:mm:ss',
                showClose: true,
                showClear: true,
                toolbarPlacement: 'top'
            });
            $('#@("EndTime")').datetimepicker({
                defaultDate: '@jobEnd',
                format: 'YYYY-MM-DD HH:mm:ss',
                showClose: true,
                showClear: true,
                toolbarPlacement: 'top',
                stepping: 15
            });
        });

        @* javascript variables set from server-side Razor code for redrawPaging.js*@
        var urlForRedrawPagingAction = '@(Url.Action("RedrawPaging", "ApiJobs", new { appName = ViewBag.JobType ?? String.Empty}))';
     </script>

    @Scripts.Render("~/Scripts/redrawPaging.js")
}
