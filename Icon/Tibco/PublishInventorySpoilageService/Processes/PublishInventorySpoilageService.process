<?xml version="1.0" encoding="UTF-8"?>
<pd:ProcessDefinition xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:pfx="http://schemas.wfm.com/Enterprise/InventoryMgmt/InventoryAdjustment/V1" xmlns:pd="http://xmlns.tibco.com/bw/process/2003" xmlns:ns="http://www.tibco.com/pe/DeployedVarsType" xmlns:BW="java://com.tibco.pe.core.JavaCustomXPATHFunctions" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns0="http://schemas.wfm.com/Enterprise/InventoryMgmt/CommonRefTypes/V1" xmlns:ns2="http://schemas.wfm.com/Enterprise/TransactionMgmt/CommonRefTypes/V1" xmlns:ns1="http://www.tibco.com/namespaces/tnt/plugins/jms" xmlns:ns4="http://www.tibco.com/pe/EngineTypes" xmlns:ns3="http://www.tibco.com/namespaces/tnt/plugins/json" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <xsd:import namespace="http://schemas.wfm.com/Enterprise/InventoryMgmt/InventoryAdjustment/V1" schemaLocation="/SharedResources/Schemas/WholeFoodsMarket/Inventory/InventoryAdjustment.xsd"/>
    <pd:name>Processes/PublishInventorySpoilageService.process</pd:name>
    <pd:startName>Timer</pd:startName>
    <pd:startX>0</pd:startX>
    <pd:startY>0</pd:startY>
    <pd:returnBindings/>
    <pd:starter name="Timer">
        <pd:type>com.tibco.plugin.timer.TimerEventSource</pd:type>
        <pd:resourceType>ae.activities.timer</pd:resourceType>
        <pd:x>119</pd:x>
        <pd:y>35</pd:y>
        <config>
            <StartTime>1538028264000</StartTime>
            <Frequency>false</Frequency>
            <TimeInterval>%%Application/PublisherTimerInMilliseconds%%</TimeInterval>
            <FrequencyIndex>Millisecond</FrequencyIndex>
        </config>
        <pd:inputBindings/>
    </pd:starter>
    <pd:endName>End</pd:endName>
    <pd:endX>1471</pd:endX>
    <pd:endY>35</pd:endY>
    <pd:errorSchemas/>
    <pd:processVariables/>
    <pd:targetNamespace>http://xmlns.example.com/1538071349052</pd:targetNamespace>
    <pd:group name="GroupAndSendSpoilageData">
        <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
        <pd:resourceType>ae.process.group</pd:resourceType>
        <pd:x>446</pd:x>
        <pd:y>74</pd:y>
        <pd:width>886</pd:width>
        <pd:height>471</pd:height>
        <pd:collapsedWidth>57</pd:collapsedWidth>
        <pd:collapsedHeight>70</pd:collapsedHeight>
        <pd:groupVariables/>
        <pd:joinToggle>inherit</pd:joinToggle>
        <config>
            <pd:groupType>inputLoop</pd:groupType>
            <pd:serializable>false</pd:serializable>
            <pd:over>$GetShrinkData/resultSet/Record/QueueId</pd:over>
            <pd:iterationElementSlot>CurrentQueueId</pd:iterationElementSlot>
            <pd:indexSlot>i</pd:indexSlot>
            <pd:activityOutputName/>
            <pd:accumulateOutput>false</pd:accumulateOutput>
        </config>
        <pd:inputBindings/>
        <pd:expanded>true</pd:expanded>
        <pd:transition>
            <pd:from>start</pd:from>
            <pd:to>ShrinkDataMapper</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Group</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Update Queue Table With Mapping Error</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>ShrinkDataMapper</pd:from>
            <pd:to>Group</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Mapper Catch</pd:from>
            <pd:to>Log Mapper Error</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Log Mapper Error</pd:from>
            <pd:to>Update Queue Table With Mapping Error</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:activity name="ShrinkDataMapper">
            <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
            <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
            <pd:x>525</pd:x>
            <pd:y>170</pd:y>
            <config>
                <element ref="pfx:inventoryAdjustments"/>
            </config>
            <pd:inputBindings>
                <xsl:for-each select="$GetShrinkData/resultSet/Record[QueueId = $CurrentQueueId/QueueId][1]">
                    <pfx:inventoryAdjustments>
                        <pfx:inventoryAdjustment>
                            <pfx:adjustmentNumber>
                                <xsl:value-of select="AdjustmentNumber"/>
                            </pfx:adjustmentNumber>
                            <pfx:eventType>
                                <xsl:value-of select="EventType"/>
                            </pfx:eventType>
                            <pfx:messageNumber>
                                <xsl:value-of select="MessageNumber"/>
                            </pfx:messageNumber>
                            <pfx:locationNumber>
                                <xsl:value-of select="LocationNumber"/>
                            </pfx:locationNumber>
                            <pfx:locationName>
                                <xsl:value-of select="LocationName"/>
                            </pfx:locationName>
                            <pfx:invAdjustmentSource>
                                <xsl:value-of select="&quot;IRMA&quot;"/>
                            </pfx:invAdjustmentSource>
                            <pfx:inventoryAdjustmentDetail>
                                <pfx:adjustmentDetailNumber>
                                    <xsl:value-of select="AdjustmentNumber"/>
                                </pfx:adjustmentDetailNumber>
                                <pfx:sourceItemKey>
                                    <xsl:value-of select="SourceItemKey"/>
                                </pfx:sourceItemKey>
                                <pfx:SubTeam>
                                    <ns0:subTeamNumber>
                                        <xsl:value-of select="SubTeamNumber"/>
                                    </ns0:subTeamNumber>
                                    <xsl:if test="SubTeamName">
                                        <ns0:subTeamName>
                                            <xsl:value-of select="SubTeamName"/>
                                        </ns0:subTeamName>
                                    </xsl:if>
                                    <ns0:hostSubTeamNumber>
                                        <xsl:value-of select="HostSubTeamNumber"/>
                                    </ns0:hostSubTeamNumber>
                                    <xsl:if test="HostSubTeamName">
                                        <ns0:hostSubTeamName>
                                            <xsl:value-of select="HostSubTeamName"/>
                                        </ns0:hostSubTeamName>
                                    </xsl:if>
                                </pfx:SubTeam>
                                <pfx:defaultScanCode>
                                    <xsl:value-of select="DefaultScanCode"/>
                                </pfx:defaultScanCode>
                                <pfx:reasonCode>
                                    <xsl:value-of select="ReasonCode"/>
                                </pfx:reasonCode>
                                <pfx:adjustmentQuantity>
                                    <ns2:quantity>
                                        <xsl:if test="AdjustmentQuantity">
                                            <ns2:value>
                                                <xsl:value-of select="AdjustmentQuantity"/>
                                            </ns2:value>
                                        </xsl:if>
                                        <ns2:units>
                                            <ns2:uom>
                                                <xsl:if test="AdjustmentQuantityUOMCode">
                                                    <ns5:code xmlns:ns5="http://schemas.wfm.com/Enterprise/UnitOfMeasureMgmt/UnitOfMeasure/V2">
                                                        <xsl:value-of select="AdjustmentQuantityUOMCode"/>
                                                    </ns5:code>
                                                </xsl:if>
                                                <xsl:if test="AdjustmentQuantityUOMName">
                                                    <ns5:name xmlns:ns5="http://schemas.wfm.com/Enterprise/UnitOfMeasureMgmt/UnitOfMeasure/V2">
                                                        <xsl:value-of select="AdjustmentQuantityUOMName"/>
                                                    </ns5:name>
                                                </xsl:if>
                                            </ns2:uom>
                                        </ns2:units>
                                    </ns2:quantity>
                                </pfx:adjustmentQuantity>
                                <pfx:userInfo>
                                    <ns0:idNumber>
                                        <xsl:value-of select="UserID"/>
                                    </ns0:idNumber>
                                    <xsl:if test="UserName">
                                        <ns0:name>
                                            <xsl:value-of select="UserName"/>
                                        </ns0:name>
                                    </xsl:if>
                                </pfx:userInfo>
                                <pfx:createDateTime>
                                    <xsl:value-of select="CurrentDateTime"/>
                                </pfx:createDateTime>
                            </pfx:inventoryAdjustmentDetail>
                        </pfx:inventoryAdjustment>
                    </pfx:inventoryAdjustments>
                </xsl:for-each>
            </pd:inputBindings>
        </pd:activity>
        <pd:group name="Group">
            <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
            <pd:resourceType>ae.process.group</pd:resourceType>
            <pd:x>596</pd:x>
            <pd:y>108</pd:y>
            <pd:width>692</pd:width>
            <pd:height>277</pd:height>
            <pd:collapsedWidth>57</pd:collapsedWidth>
            <pd:collapsedHeight>70</pd:collapsedHeight>
            <pd:groupVariables/>
            <pd:joinToggle>inherit</pd:joinToggle>
            <config>
                <pd:groupType>simpleGroup</pd:groupType>
                <pd:serializable>false</pd:serializable>
            </config>
            <pd:inputBindings/>
            <pd:expanded>true</pd:expanded>
            <pd:transition>
                <pd:from>start</pd:from>
                <pd:to>SendDataToESB</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>Update Inventory Queue Table</pd:from>
                <pd:to>end</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>Update Queue Table With Error</pd:from>
                <pd:to>end</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>SendDataToESB</pd:from>
                <pd:to>Convert Message to JSON</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>Convert Message to JSON</pd:from>
                <pd:to>Archive Message</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>Archive Message</pd:from>
                <pd:to>Update Inventory Queue Table</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>CatchSendingToEsbException</pd:from>
                <pd:to>Log Error Inside Group</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>Log Error Inside Group</pd:from>
                <pd:to>ConvertToJSon</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>ConvertToJSon</pd:from>
                <pd:to>Archive Message On Error</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:transition>
                <pd:from>Archive Message On Error</pd:from>
                <pd:to>Update Queue Table With Error</pd:to>
                <pd:lineType>Default</pd:lineType>
                <pd:lineColor>-16777216</pd:lineColor>
                <pd:conditionType>always</pd:conditionType>
            </pd:transition>
            <pd:activity name="SendDataToESB">
                <pd:type>com.tibco.plugin.jms.JMSTopicPublishActivity</pd:type>
                <pd:resourceType>ae.activities.JMSTopicPublishActivity</pd:resourceType>
                <pd:x>694</pd:x>
                <pd:y>178</pd:y>
                <config>
                    <PermittedMessageType>XML Text</PermittedMessageType>
                    <SessionAttributes>
                        <transacted>false</transacted>
                        <acknowledgeMode>1</acknowledgeMode>
                        <maxSessions>1</maxSessions>
                        <destination>%%Destinations/InventoryManagementTopic%%</destination>
                    </SessionAttributes>
                    <ConfigurableHeaders>
                        <JMSDeliveryMode>PERSISTENT</JMSDeliveryMode>
                        <JMSExpiration>0</JMSExpiration>
                        <JMSPriority>4</JMSPriority>
                    </ConfigurableHeaders>
                    <ConnectionReference>/SharedResources/Connections/ESB.sharedjmscon</ConnectionReference>
                    <ApplicationProperties>/SharedResources/Properties/JMS-Application-Properties-InventoryManagement.sharedjmsapp</ApplicationProperties>
                    <InDataxsdString ref="pfx:inventoryAdjustments"/>
                </config>
                <pd:inputBindings>
                    <ns1:ActivityInput>
                        <OtherProperties>
                            <TransactionID>
                                <xsl:value-of select="concat($ShrinkDataMapper/pfx:inventoryAdjustments/pfx:inventoryAdjustment[1]/pfx:locationNumber, $_globalVariables/ns:GlobalVariables/Application/TransactionType, $ShrinkDataMapper/pfx:inventoryAdjustments/pfx:inventoryAdjustment[1]/pfx:messageNumber)"/>
                            </TransactionID>
                            <TransactionType>
                                <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/TransactionType"/>
                            </TransactionType>
                            <Source>
                                <xsl:value-of select="&quot;IRMA&quot;"/>
                            </Source>
                            <MessageType>
                                <xsl:value-of select="&quot;TEXT&quot;"/>
                            </MessageType>
                            <MessageNumber>
                                <xsl:value-of select="$ShrinkDataMapper/pfx:inventoryAdjustments/pfx:inventoryAdjustment[1]/pfx:messageNumber"/>
                            </MessageNumber>
                        </OtherProperties>
                        <Body>
                            <xsl:copy-of select="$ShrinkDataMapper/pfx:inventoryAdjustments"/>
                        </Body>
                    </ns1:ActivityInput>
                </pd:inputBindings>
            </pd:activity>
            <pd:activity name="Archive Message">
                <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
                <pd:resourceType>ae.process.subprocess</pd:resourceType>
                <pd:x>973</pd:x>
                <pd:y>178</pd:y>
                <config>
                    <processName>/SharedResources/Processes/ArchiveInventoryManagementMessage.process</processName>
                    <spawn>true</spawn>
                </config>
                <pd:inputBindings>
                    <Input>
                        <MessageBody>
                            <xsl:value-of select="$Convert-Message-to-JSON/ns3:ActivityOutputClass/jsonString"/>
                        </MessageBody>
                        <EventType>
                            <xsl:value-of select="$ShrinkDataMapper/pfx:inventoryAdjustments/pfx:inventoryAdjustment[1]/pfx:eventType"/>
                        </EventType>
                        <KeyID>
                            <xsl:value-of select="$ShrinkDataMapper/pfx:inventoryAdjustments/pfx:inventoryAdjustment[1]/pfx:adjustmentNumber"/>
                        </KeyID>
                        <SecondaryKeyID>
                            <xsl:value-of select="0"/>
                        </SecondaryKeyID>
                        <Status>
                            <xsl:value-of select="&quot;P&quot;"/>
                        </Status>
                        <MessageNumber>
                            <xsl:value-of select="$ShrinkDataMapper/pfx:inventoryAdjustments/pfx:inventoryAdjustment[1]/pfx:messageNumber"/>
                        </MessageNumber>
                        <LastReprocessID>
                            <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                        </LastReprocessID>
                        <QueueID>
                            <xsl:value-of select="$CurrentQueueId/QueueId"/>
                        </QueueID>
                    </Input>
                </pd:inputBindings>
            </pd:activity>
            <pd:activity name="Update Inventory Queue Table">
                <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
                <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
                <pd:x>1128</pd:x>
                <pd:y>186</pd:y>
                <config>
                    <timeout>10</timeout>
                    <commit>false</commit>
                    <emptyStrAsNil>false</emptyStrAsNil>
                    <statement>UPDATE [amz].[InventoryQueue]
SET Status ='P',
	 InProcessBy = NULL,
	ProcessTimes = IsNull(ProcessTimes, 0) +1,
	LastProcessedTime = getdate(),
        ErrorDescription =''
 WHERE QueueId =?
AND InProcessBy = ?
And STATUS = 'I'</statement>
                    <jdbcSharedConfig>/SharedResources/Connections/IRMA.sharedjdbc</jdbcSharedConfig>
                    <Prepared_Param_DataType>
                        <parameter>
                            <parameterName>QueueId</parameterName>
                            <dataType>INTEGER</dataType>
                        </parameter>
                        <parameter>
                            <parameterName>InProcessBy</parameterName>
                            <dataType>INTEGER</dataType>
                        </parameter>
                    </Prepared_Param_DataType>
                </config>
                <pd:inputBindings>
                    <jdbcUpdateActivityInput>
                        <QueueId>
                            <xsl:value-of select="$CurrentQueueId/QueueId"/>
                        </QueueId>
                        <InProcessBy>
                            <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                        </InProcessBy>
                    </jdbcUpdateActivityInput>
                </pd:inputBindings>
            </pd:activity>
            <pd:activity name="Convert Message to JSON">
                <pd:type>com.tibco.plugin.json.activities.JSONRenderActivity</pd:type>
                <pd:resourceType>ae.activities.JSONRenderActivity</pd:resourceType>
                <pd:x>829</pd:x>
                <pd:y>186</pd:y>
                <config>
                    <SchemaType>xsdType</SchemaType>
                    <BadgerfishCheck>false</BadgerfishCheck>
                    <ActivityInputEditor ref="pfx:inventoryAdjustments"/>
                </config>
                <pd:inputBindings>
                    <ns3:ActivityInputClass>
                        <xsl:copy-of select="$ShrinkDataMapper/pfx:inventoryAdjustments"/>
                    </ns3:ActivityInputClass>
                </pd:inputBindings>
            </pd:activity>
            <pd:activity name="CatchSendingToEsbException">
                <pd:type>com.tibco.pe.core.CatchActivity</pd:type>
                <pd:resourceType>ae.activities.catch</pd:resourceType>
                <pd:x>662</pd:x>
                <pd:y>292</pd:y>
                <pd:handler>true</pd:handler>
                <config>
                    <fault>localname=JMSSendException namespace=http://schemas.tibco.com/bw/plugins/jms/5.0/jmsExceptions</fault>
                    <catchAll>true</catchAll>
                </config>
                <pd:inputBindings/>
            </pd:activity>
            <pd:activity name="Log Error Inside Group">
                <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
                <pd:resourceType>ae.process.subprocess</pd:resourceType>
                <pd:x>789</pd:x>
                <pd:y>300</pd:y>
                <config>
                    <processName>/SharedResources/Processes/LogPublisher.process</processName>
                    <spawn>true</spawn>
                </config>
                <pd:inputBindings>
                    <LogElement>
                        <LogDate>
                            <xsl:value-of select="current-dateTime()"/>
                        </LogDate>
                        <ApplicationID>
                            <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/ApplicationId"/>
                        </ApplicationID>
                        <HostName>
                            <xsl:value-of select="BW:getHostName()"/>
                        </HostName>
                        <UserName>
                            <xsl:value-of select="$_processContext/ns4:ProcessContext/ProjectName"/>
                        </UserName>
                        <Thread>
                            <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                        </Thread>
                        <Level>
                            <xsl:value-of select="&quot;Error&quot;"/>
                        </Level>
                        <Logger>
                            <xsl:value-of select="&quot;Publish Inventory Spoilage Service&quot;"/>
                        </Logger>
                        <Message>
                            <xsl:value-of select="$_error/ns4:ErrorReport/Msg"/>
                        </Message>
                        <Exception>
                            <xsl:value-of select="$_error/ns4:ErrorReport/ProcessStack"/>
                        </Exception>
                        <InsertedDate>
                            <xsl:value-of select="current-dateTime()"/>
                        </InsertedDate>
                    </LogElement>
                </pd:inputBindings>
            </pd:activity>
            <pd:activity name="Update Queue Table With Error">
                <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
                <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
                <pd:x>1180</pd:x>
                <pd:y>300</pd:y>
                <config>
                    <timeout>10</timeout>
                    <commit>false</commit>
                    <emptyStrAsNil>false</emptyStrAsNil>
                    <jdbcSharedConfig>/SharedResources/Connections/IRMA.sharedjdbc</jdbcSharedConfig>
                    <statement>UPDATE [amz].[InventoryQueue]
SET InProcessBy = NULL,
        Status ='P',
	ProcessTimes = IsNull(ProcessTimes, 0) +1,
	LastProcessedTime = getdate(),
	ErrorDescription = ?
 WHERE QueueID =?
AND InProcessBy = ?
And STATUS = 'I'</statement>
                    <Prepared_Param_DataType>
                        <parameter>
                            <parameterName>ErrorDescription</parameterName>
                            <dataType>VARCHAR</dataType>
                        </parameter>
                        <parameter>
                            <parameterName>QueueID</parameterName>
                            <dataType>INTEGER</dataType>
                        </parameter>
                        <parameter>
                            <parameterName>InProcessBy</parameterName>
                            <dataType>INTEGER</dataType>
                        </parameter>
                    </Prepared_Param_DataType>
                </config>
                <pd:inputBindings>
                    <jdbcUpdateActivityInput>
                        <ErrorDescription>
                            <xsl:choose>
                                <xsl:when test="exists($_error/ns4:ErrorReport/Msg)">
                                    <xsl:value-of select="$_error/ns4:ErrorReport/Msg"/>
                                </xsl:when>
                                <xsl:otherwise>
                                    <xsl:attribute name="xsi:nil">true</xsl:attribute>
                                </xsl:otherwise>
                            </xsl:choose>
                        </ErrorDescription>
                        <QueueID>
                            <xsl:choose>
                                <xsl:when test="exists(1)">
                                    <xsl:value-of select="1"/>
                                </xsl:when>
                                <xsl:otherwise>
                                    <xsl:attribute name="xsi:nil">true</xsl:attribute>
                                </xsl:otherwise>
                            </xsl:choose>
                        </QueueID>
                        <InProcessBy>
                            <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                        </InProcessBy>
                    </jdbcUpdateActivityInput>
                </pd:inputBindings>
            </pd:activity>
            <pd:activity name="ConvertToJSon">
                <pd:type>com.tibco.plugin.json.activities.JSONRenderActivity</pd:type>
                <pd:resourceType>ae.activities.JSONRenderActivity</pd:resourceType>
                <pd:x>902</pd:x>
                <pd:y>292</pd:y>
                <config>
                    <SchemaType>xsdType</SchemaType>
                    <BadgerfishCheck>false</BadgerfishCheck>
                    <ActivityInputEditor ref="pfx:inventoryAdjustments"/>
                </config>
                <pd:inputBindings>
                    <ns3:ActivityInputClass>
                        <xsl:copy-of select="$ShrinkDataMapper/pfx:inventoryAdjustments"/>
                    </ns3:ActivityInputClass>
                </pd:inputBindings>
            </pd:activity>
            <pd:activity name="Archive Message On Error">
                <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
                <pd:resourceType>ae.process.subprocess</pd:resourceType>
                <pd:x>1042</pd:x>
                <pd:y>300</pd:y>
                <config>
                    <processName>/SharedResources/Processes/ArchiveInventoryManagementMessage.process</processName>
                    <spawn>true</spawn>
                </config>
                <pd:inputBindings>
                    <Input>
                        <MessageBody>
                            <xsl:value-of select="$ConvertToJSon/ns3:ActivityOutputClass/jsonString"/>
                        </MessageBody>
                        <EventType>
                            <xsl:value-of select="$GetShrinkData/resultSet/Record[1]/EventType"/>
                        </EventType>
                        <KeyID>
                            <xsl:value-of select="$GetShrinkData/resultSet/Record[1]/AdjustmentNumber"/>
                        </KeyID>
                        <SecondaryKeyID>
                            <xsl:value-of select="0"/>
                        </SecondaryKeyID>
                        <Status>
                            <xsl:value-of select="&quot;U&quot;"/>
                        </Status>
                        <MessageNumber>
                            <xsl:value-of select="$GetShrinkData/resultSet/Record[1]/MessageNumber"/>
                        </MessageNumber>
                        <LastReprocessID>
                            <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                        </LastReprocessID>
                        <QueueID>
                            <xsl:value-of select="$CurrentQueueId/QueueId"/>
                        </QueueID>
                    </Input>
                </pd:inputBindings>
            </pd:activity>
        </pd:group>
        <pd:activity name="Mapper Catch">
            <pd:type>com.tibco.pe.core.CatchActivity</pd:type>
            <pd:resourceType>ae.activities.catch</pd:resourceType>
            <pd:x>530</pd:x>
            <pd:y>432</pd:y>
            <pd:handler>true</pd:handler>
            <config>
                <catchAll>true</catchAll>
            </config>
            <pd:inputBindings/>
        </pd:activity>
        <pd:activity name="Log Mapper Error">
            <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
            <pd:resourceType>ae.process.subprocess</pd:resourceType>
            <pd:x>895</pd:x>
            <pd:y>436</pd:y>
            <config>
                <processName>/SharedResources/Processes/LogPublisher.process</processName>
            </config>
            <pd:inputBindings>
                <LogElement>
                    <LogDate>
                        <xsl:value-of select="current-dateTime()"/>
                    </LogDate>
                    <ApplicationID>
                        <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/ApplicationId"/>
                    </ApplicationID>
                    <HostName>
                        <xsl:value-of select="BW:getHostName()"/>
                    </HostName>
                    <UserName>
                        <xsl:value-of select="$_processContext/ns4:ProcessContext/ProjectName"/>
                    </UserName>
                    <Thread>
                        <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                    </Thread>
                    <Level>
                        <xsl:value-of select="&quot;Error&quot;"/>
                    </Level>
                    <Logger>
                        <xsl:value-of select="&quot;Publish Inventory Spoilage Service&quot;"/>
                    </Logger>
                    <Message>
                        <xsl:value-of select="$_error/ns4:ErrorReport/Msg"/>
                    </Message>
                    <xsl:if test="$_error/ns4:ErrorReport/MsgCode">
                        <Exception>
                            <xsl:value-of select="$_error/ns4:ErrorReport/MsgCode"/>
                        </Exception>
                    </xsl:if>
                    <InsertedDate>
                        <xsl:value-of select="current-dateTime()"/>
                    </InsertedDate>
                </LogElement>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="Update Queue Table With Mapping Error">
            <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
            <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
            <pd:x>1249</pd:x>
            <pd:y>446</pd:y>
            <config>
                <timeout>10</timeout>
                <commit>false</commit>
                <emptyStrAsNil>false</emptyStrAsNil>
                <statement>UPDATE [amz].[InventoryQueue]
SET Status ='F',
	 InProcessBy = NULL,
	ProcessTimes = IsNull(ProcessTimes, 0) +1,
	LastProcessedTime = getdate(),
        ErrorDescription = ?
 WHERE QueueID =?
AND InProcessBy = ?
And STATUS = 'I'</statement>
                <jdbcSharedConfig>/SharedResources/Connections/IRMA.sharedjdbc</jdbcSharedConfig>
                <Prepared_Param_DataType>
                    <parameter>
                        <parameterName>ErrorDescription</parameterName>
                        <dataType>VARCHAR</dataType>
                    </parameter>
                    <parameter>
                        <parameterName>QueueID</parameterName>
                        <dataType>INTEGER</dataType>
                    </parameter>
                    <parameter>
                        <parameterName>InProcessBy</parameterName>
                        <dataType>INTEGER</dataType>
                    </parameter>
                </Prepared_Param_DataType>
            </config>
            <pd:inputBindings>
                <jdbcUpdateActivityInput>
                    <QueueID>
                        <xsl:value-of select="$CurrentQueueId/QueueId"/>
                    </QueueID>
                    <InProcessBy>
                        <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                    </InProcessBy>
                </jdbcUpdateActivityInput>
            </pd:inputBindings>
        </pd:activity>
    </pd:group>
    <pd:activity name="DB Catch">
        <pd:type>com.tibco.pe.core.CatchActivity</pd:type>
        <pd:resourceType>ae.activities.catch</pd:resourceType>
        <pd:x>124</pd:x>
        <pd:y>602</pd:y>
        <pd:handler>true</pd:handler>
        <config>
            <catchAll>true</catchAll>
        </config>
        <pd:inputBindings/>
    </pd:activity>
    <pd:activity name="Get ApplicationID">
        <pd:type>com.tibco.plugin.jdbc.JDBCQueryActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCQueryActivity</pd:resourceType>
        <pd:x>363</pd:x>
        <pd:y>326</pd:y>
        <config>
            <timeout>10</timeout>
            <commit>false</commit>
            <maxRows>100</maxRows>
            <emptyStrAsNil>false</emptyStrAsNil>
            <jdbcSharedConfig>/SharedResources/Connections/IRMA.sharedjdbc</jdbcSharedConfig>
            <statement>SELECT	 TOP 1 ApplicationID
		FROM
		AppConfigApp
		WHERE EnvironmentID= (SELECT EnvironmentID FROM AppConfigEnv WHERE Name = (SELECT TOP 1 Environment From version))
			  AND NAME ='IRMA CLIENT'</statement>
            <oraObjects/>
            <oraTables/>
            <QueryOutputCachedSchemaColumns>ApplicationID</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>1</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>uniqueidentifier</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
        </config>
        <pd:inputBindings>
            <jdbcQueryActivityInput/>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="GetShrinkData">
        <pd:type>com.tibco.plugin.jdbc.JDBCQueryActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCQueryActivity</pd:resourceType>
        <pd:x>356</pd:x>
        <pd:y>35</pd:y>
        <config>
            <timeout>120</timeout>
            <commit>false</commit>
            <maxRows>%%Application/BatchSize%%</maxRows>
            <emptyStrAsNil>false</emptyStrAsNil>
            <processInSubsets>false</processInSubsets>
            <jdbcSharedConfig>/SharedResources/Connections/IRMA.sharedjdbc</jdbcSharedConfig>
            <statement>SELECT
	iq.QueueID as QueueId,
	ih.ItemHistoryID as AdjustmentNumber,
	et.EventTypeCode as EventType,
	cast(Datediff(s, '1970-01-01', iq.MessageTimestampUtc) AS bigint) * 1000 AS MessageNumber,
	s.BusinessUnit_ID LocationNumber, 
	s.Store_Name as LocationName,
	i.SubTeam_No as HostSubTeamNumber,
	st.SubTeam_Name as HostSubTeamName,
	ih.SubTeam_No as SubTeamNumber,
    ss.SubTeam_Name as SubTeamName,
	ii.Identifier as DefaultScanCode,
	ih.AdjustmentReason as ReasonCode,
	case 
        when IsNull(ih.Quantity, 0) = 0
        then ih.Weight
        else ih.Quantity
    End as AdjustmentQuantity,
	SubString(iu.Unit_Name,1,5) as AdjustmentQuantityUOMName,
	iu.Unit_Abbreviation as AdjustmentQuantityUOMCode,
	ih.Item_Key as SourceItemKey,
	ih.DateStamp  as CurrentDateTime,
	ih.CreatedBy as UserID,
	us.FullName as UserName

FROM
	amz.InventoryQueue as iq
	JOIN amz.EventType et on et.EventTypeID = iq.EventTypeID
	JOIN dbo.ItemHistory as ih on  iq.KeyID = ih.ItemHistoryID
	JOIN Store as s on s.Store_No = ih.Store_No
	JOIN Item as i on i.Item_Key = ih.Item_Key
	JOIN ItemIdentifier as ii on ii.Item_Key = i.Item_Key
	JOIN ItemUnit as iu on iu.Unit_ID = i.Retail_Unit_ID
	JOIN SubTeam st on st.SubTeam_No = i.SubTeam_No
	JOIN SubTeam ss on ss.SubTeam_No = ih.SubTeam_No
	JOIN Users us on ih.CreatedBy = us.User_ID
WHERE iq.Status in ('I') AND ii.Default_Identifier = 1 AND InProcessBy = ? 
ORDER BY KeyID 
</statement>
            <wizardData/>
            <Prepared_Param_DataType>
                <parameter>
                    <parameterName>InProcessBy</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
            </Prepared_Param_DataType>
            <oraObjects/>
            <oraTables/>
            <QueryOutputCachedSchemaColumns>QueueId</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>4</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>int</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>AdjustmentNumber</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>4</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>int</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>EventType</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>-9</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>nvarchar</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>MessageNumber</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>-5</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>bigint</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>LocationNumber</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>4</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>int</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>LocationName</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>varchar</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>HostSubTeamNumber</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>4</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>int</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>HostSubTeamName</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>varchar</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>SubTeamNumber</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>4</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>int</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>SubTeamName</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>varchar</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>DefaultScanCode</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>varchar</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>ReasonCode</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>varchar</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>AdjustmentQuantity</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>3</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>decimal</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>AdjustmentQuantityUOMName</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>varchar</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>AdjustmentQuantityUOMCode</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>varchar</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>SourceItemKey</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>4</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>int</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>CurrentDateTime</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>93</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>datetime</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>UserID</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>4</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>int</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>RequiredElement</QueryOutputCachedSchemaStatus>
            <QueryOutputCachedSchemaColumns>UserName</QueryOutputCachedSchemaColumns>
            <QueryOutputCachedSchemaDataTypes>12</QueryOutputCachedSchemaDataTypes>
            <QueryOutputCachedSchemaDataTypesName>varchar</QueryOutputCachedSchemaDataTypesName>
            <QueryOutputCachedSchemaStatus>OptionalElement</QueryOutputCachedSchemaStatus>
        </config>
        <pd:inputBindings>
            <jdbcQueryActivityInput>
                <InProcessBy>
                    <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                </InProcessBy>
            </jdbcQueryActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Log DB Error">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>830</pd:x>
        <pd:y>602</pd:y>
        <config>
            <processName>/SharedResources/Processes/LogPublisher.process</processName>
            <spawn>true</spawn>
        </config>
        <pd:inputBindings>
            <LogElement>
                <LogDate>
                    <xsl:value-of select="current-dateTime()"/>
                </LogDate>
                <ApplicationID>
                    <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/ApplicationId"/>
                </ApplicationID>
                <HostName>
                    <xsl:value-of select="BW:getHostName()"/>
                </HostName>
                <UserName>
                    <xsl:value-of select="$_processContext/ns4:ProcessContext/ProjectName"/>
                </UserName>
                <Thread>
                    <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                </Thread>
                <Level>
                    <xsl:value-of select="&quot;Error&quot;"/>
                </Level>
                <Logger>
                    <xsl:value-of select="&quot;Publish Inventory Spoilage Service&quot;"/>
                </Logger>
                <Message>
                    <xsl:value-of select="$_error/ns4:ErrorReport/Msg"/>
                </Message>
                <xsl:if test="$_error/ns4:ErrorReport/MsgCode">
                    <Exception>
                        <xsl:value-of select="$_error/ns4:ErrorReport/MsgCode"/>
                    </Exception>
                </xsl:if>
                <InsertedDate>
                    <xsl:value-of select="current-dateTime()"/>
                </InsertedDate>
            </LogElement>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Update Errors">
        <pd:type>com.tibco.plugin.jdbc.JDBCUpdateActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCUpdateActivity</pd:resourceType>
        <pd:x>1481</pd:x>
        <pd:y>602</pd:y>
        <config>
            <timeout>10</timeout>
            <commit>false</commit>
            <emptyStrAsNil>false</emptyStrAsNil>
            <statement>UPDATE [amz].[InventoryQueue]
SET InProcessBy = NULL,
    Status ='F',
	ProcessTimes = IsNull(ProcessTimes, 0) +1,
	LastProcessedTime = getdate(),
	ErrorDescription = ?
 WHERE  InProcessBy = ?
And STATUS = 'I'</statement>
            <jdbcSharedConfig>/SharedResources/Connections/IRMA.sharedjdbc</jdbcSharedConfig>
            <Prepared_Param_DataType>
                <parameter>
                    <parameterName>ErrorDescription</parameterName>
                    <dataType>VARCHAR</dataType>
                </parameter>
                <parameter>
                    <parameterName>InProcessBy</parameterName>
                    <dataType>INTEGER</dataType>
                </parameter>
            </Prepared_Param_DataType>
        </config>
        <pd:inputBindings>
            <jdbcUpdateActivityInput>
                <ErrorDescription>
                    <xsl:choose>
                        <xsl:when test="exists($_error/ns4:ErrorReport/Msg)">
                            <xsl:value-of select="$_error/ns4:ErrorReport/Msg"/>
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:attribute name="xsi:nil">true</xsl:attribute>
                        </xsl:otherwise>
                    </xsl:choose>
                </ErrorDescription>
                <InProcessBy>
                    <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                </InProcessBy>
            </jdbcUpdateActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="UpdateInventorySpoilageEvents">
        <pd:type>com.tibco.plugin.jdbc.JDBCCallActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCCallActivity</pd:resourceType>
        <pd:x>248</pd:x>
        <pd:y>35</pd:y>
        <config>
            <timeout>10</timeout>
            <maxRows>20000</maxRows>
            <emptyStrAsNil>false</emptyStrAsNil>
            <jdbcSharedConfig>/SharedResources/Connections/IRMA.sharedjdbc</jdbcSharedConfig>
            <schema>amz</schema>
            <catalog/>
            <ProcedureName>LockInventorySpoilage</ProcedureName>
            <parameterTypes>
                <parameter>
                    <colName>@RETURN_VALUE</colName>
                    <colType>5</colType>
                    <dataType>4</dataType>
                    <typeName>int</typeName>
                </parameter>
                <parameter>
                    <colName>@NumberOfEntriesToProcess</colName>
                    <colType>1</colType>
                    <dataType>4</dataType>
                    <typeName>int</typeName>
                </parameter>
                <parameter>
                    <colName>@Instance</colName>
                    <colType>1</colType>
                    <dataType>4</dataType>
                    <typeName>int</typeName>
                </parameter>
                <parameter>
                    <colName>@ProcessDelayTimeInMinutes</colName>
                    <colType>1</colType>
                    <dataType>4</dataType>
                    <typeName>int</typeName>
                </parameter>
                <parameter>
                    <colName>@WaitTimeForRecordsProcessedThreetimes</colName>
                    <colType>1</colType>
                    <dataType>4</dataType>
                    <typeName>int</typeName>
                </parameter>
                <parameter>
                    <colName>@WaitTimeForRecordsProcessedFourtimes</colName>
                    <colType>1</colType>
                    <dataType>4</dataType>
                    <typeName>int</typeName>
                </parameter>
                <parameter>
                    <colName>@WaitTimeForRecordsProcessedFivetimes</colName>
                    <colType>1</colType>
                    <dataType>4</dataType>
                    <typeName>int</typeName>
                </parameter>
            </parameterTypes>
        </config>
        <pd:inputBindings>
            <inputs>
                <inputSet>
                    <NumberOfEntriesToProcess>
                        <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/BatchSize"/>
                    </NumberOfEntriesToProcess>
                    <Instance>
                        <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/InstanceId"/>
                    </Instance>
                    <ProcessDelayTimeInMinutes>
                        <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/ProcessDelayTimeInMinutes"/>
                    </ProcessDelayTimeInMinutes>
                    <WaitTimeForRecordsProcessedThreetimes>
                        <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/WaitTimeForRecordsProcessedThreetimes"/>
                    </WaitTimeForRecordsProcessedThreetimes>
                    <WaitTimeForRecordsProcessedFourtimes>
                        <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/WaitTimeForRecordsProcessedFourtimes"/>
                    </WaitTimeForRecordsProcessedFourtimes>
                    <WaitTimeForRecordsProcessedFivetimes>
                        <xsl:value-of select="$_globalVariables/ns:GlobalVariables/Application/WaitTimeForRecordsProcessedFivetimes"/>
                    </WaitTimeForRecordsProcessedFivetimes>
                </inputSet>
            </inputs>
        </pd:inputBindings>
    </pd:activity>
    <pd:transition>
        <pd:from>Timer</pd:from>
        <pd:to>UpdateInventorySpoilageEvents</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>UpdateInventorySpoilageEvents</pd:from>
        <pd:to>GetShrinkData</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>GroupAndSendSpoilageData</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>GetShrinkData</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>otherwise</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>GetShrinkData</pd:from>
        <pd:to>Get ApplicationID</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>exists($GetShrinkData/resultSet/Record)</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>Get ApplicationID</pd:from>
        <pd:to>GroupAndSendSpoilageData</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Update Errors</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Log DB Error</pd:from>
        <pd:to>Update Errors</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>DB Catch</pd:from>
        <pd:to>Log DB Error</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
</pd:ProcessDefinition>