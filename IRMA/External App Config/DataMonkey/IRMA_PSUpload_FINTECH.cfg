<?xml version="1.0" encoding="utf-8" ?>
<!--
**************************************************************************************
       File: IRMA_PSUpload_FINTEC.cfg
       Author: Denis Ng
       Date: 09/16/2013
       Description:

This file contains key settings that drive the transfer of vendor data from IRMA to StoreOps
*THIS VERSION IS FOR USE WITH IRMA 4.X DATABASES AND HIGHER
**************************************************************************************
-->

<configuration>
	<config key="conTimeout"         			value="1800"/>
	<config key="sqlTimeout"         			value="1800"/>

<!-- these values should be coming from system wide environmental variables
	<config key="DM_prod_level"				value="Prod"/>
	<config key="DM_emailFrom"				value="denis.ng@wholefoods.com"/>
	<config key="DM_emailTo"				value="denis.ng@wholefoods.com"/>
-->
	<config key="emailSMTPServer"    			value="smtp.wholefoods.com"/>

	<config key="fnamePrefix"				value="PSFINTECH"/>

	<config key="LogFile"					value="e:/IRMA/logs/{Reg}/{fnamePrefix}_{yyyy}{MM}{dd}.log"/>
 
	<config key="ParameterFile"				value="conf/{Reg}_{fnamePrefix}.prm"/>
	
	<config key="FeedName"           			value="IRMA FINTEC"/>
	<config key="App"                			value="DM - PeopleSoft Upload FINTEC"/> 
	<config key="arg-delim"          			value="~"/>
	<config key="pipe"               			value="|"/>
	<!--<config key="pipe_factor"  				value=",,,,,'{Reg}'"/>-->

	<!-- Database Connection string keys -->
	<config key="IRMA_Source"      				value="FILE:conn/{Reg}_IRMA_Connection.txt"/>

	<!-- Connections to process -->
	<config key="maxEntries"         			value="1"/>
	<config key="source_1"           			value="DB, IRMA_Source, QUERY, inputquery, pipe"/>

	<config key="target_1"  				value="FILE, REPLACE, e:\data\PSFILES\{Reg}\{fnamePrefix}_{Reg}_{yyyy}{MM}{dd}.txt, pipe, , , , , , "/>
	<config key="target_1_Debug"  				value="FILE, REPLACE, e:\IRMA\logs\{Reg}\{fnamePrefix}{yyyy}{MM}{dd}{hh}{mi}{ss}.txt, pipe, , , , , , "/>

	<!-- Database Commands -->

	<!-- Email notification, on error -->
	<config key="notify_1"					value="Feed Error,"/>
	<config key="Feed Error"				value="Feed Error Msg, [{DM_prod_level}] {FeedName} Feed Error - {Reg}, {DM_emailFrom}, {DM_emailTo} "/>
	<config key="Feed Error Msg"				value="FILE:conf/error_msg.htm"/>

	<config key="inputquery"   value="SELECT
					V.PS_Vendor_ID,
					V.PS_Export_Vendor_ID,
					OH.OrderHeader_ID,
					OH.InvoiceNumber,
					OH.OrderExternalSourceOrderID,
					--OH.Transfer_To_SubTeam,
					SST.PS_Team_No,
					SST.PS_SubTeam_No,
					OH.SentDate,
					OH.CloseDate,
					OH.Return_Order 
					FROM OrderHeader OH (NOLOCK) INNER JOIN Vendor V (NOLOCK)
					ON OH.Vendor_ID = V.Vendor_ID
					INNER JOIN Vendor RecV (NOLOCK)
					ON OH.ReceiveLocation_ID = RecV.Vendor_ID 
					INNER JOIN Store S (NOLOCK)
					ON RecV.Store_no = S.Store_No 
					INNER JOIN VendorPaymentTerms VPT (NOLOCK)
					ON V.PaymentTermID = VPT.PaymentTermID
					INNER JOIN StoreSubTeam SST (NOLOCK)
					ON OH.Transfer_To_SubTeam = SST.Subteam_No AND SST.Store_No = RecV.Store_no 
					WHERE VPT.Description = 'FINTECH' AND
					CONVERT(DATE, OH.SentDate) BETWEEN CONVERT(DATE, DATEADD(d, -90,GETDATE())) AND CONVERT(DATE, GETDATE())"/>

</configuration>