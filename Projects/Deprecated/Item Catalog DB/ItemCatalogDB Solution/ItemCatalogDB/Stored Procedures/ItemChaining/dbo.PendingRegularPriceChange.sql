if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PendingRegularPriceChange]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
drop procedure [dbo].[PendingRegularPriceChange]
GO

CREATE PROCEDURE [dbo].[PendingRegularPriceChange] 
@Items varchar(MAX),
@Stores varchar(MAX),
@StartDate varchar(20)

AS

BEGIN
  DECLARE @SQL varchar(MAX)
  
SELECT @SQL = ' select count(*) Found from PriceBatchDetail PBD'
SELECT @SQL = @SQL + ' where PBD.Store_No in ('+@Stores+')'
SELECT @SQL = @SQL + ' and PBD.Item_Key in('+@Items+')'
SELECT @SQL = @SQL + ' and PBD.Expired = 0'
SELECT @SQL = @SQL + ' and PBD.PriceBatchHeaderID is null'
SELECT @SQL = @SQL + ' and PBD.AutoGenerated = 0'
SELECT @SQL = @SQL + ' and dbo.fn_OnSale(PBD.PriceChgTypeId) = 0'
SELECT @SQL = @SQL + ' and PBD.StartDate >= '''+@StartDate+''''

 
EXECUTE(@SQL)
END 
go