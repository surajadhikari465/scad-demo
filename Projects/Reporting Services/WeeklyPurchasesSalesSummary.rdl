<?xml version="1.0" encoding="utf-8"?>
<Report xmlns="http://schemas.microsoft.com/sqlserver/reporting/2005/01/reportdefinition" xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner">
  <DataSources>
    <DataSource Name="ItemCatalog">
      <rd:DataSourceID>5ba21e16-d2b6-473e-b9d6-0a1162e8471c</rd:DataSourceID>
      <DataSourceReference>ItemCatalog</DataSourceReference>
    </DataSource>
  </DataSources>
  <InteractiveHeight>11in</InteractiveHeight>
  <ReportParameters>
    <ReportParameter Name="DC_Vendor_Id">
      <DataType>Integer</DataType>
      <DefaultValue>
        <Values>
          <Value>2255</Value>
        </Values>
      </DefaultValue>
      <Prompt>DC Vendor Id</Prompt>
    </ReportParameter>
    <ReportParameter Name="Start_Date">
      <DataType>DateTime</DataType>
      <DefaultValue>
        <Values>
          <Value>2/2/2009</Value>
        </Values>
      </DefaultValue>
      <AllowBlank>true</AllowBlank>
      <Prompt>Start Date</Prompt>
    </ReportParameter>
    <ReportParameter Name="End_Date">
      <DataType>DateTime</DataType>
      <DefaultValue>
        <Values>
          <Value>2/8/2009</Value>
        </Values>
      </DefaultValue>
      <AllowBlank>true</AllowBlank>
      <Prompt>End Date</Prompt>
    </ReportParameter>
    <ReportParameter Name="InvChg">
      <DataType>String</DataType>
      <Prompt>InvChg</Prompt>
    </ReportParameter>
  </ReportParameters>
  <rd:DrawGrid>true</rd:DrawGrid>
  <InteractiveWidth>8.5in</InteractiveWidth>
  <rd:SnapToGrid>true</rd:SnapToGrid>
  <RightMargin>0.25in</RightMargin>
  <LeftMargin>0.25in</LeftMargin>
  <PageHeader>
    <PrintOnFirstPage>true</PrintOnFirstPage>
    <ReportItems>
      <Textbox Name="textbox1">
        <Top>0.375in</Top>
        <Width>5.125in</Width>
        <Style>
          <Color>SteelBlue</Color>
          <FontFamily>Tahoma</FontFamily>
          <FontSize>14pt</FontSize>
          <FontWeight>700</FontWeight>
          <TextAlign>Center</TextAlign>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
          <PaddingTop>2pt</PaddingTop>
          <PaddingBottom>2pt</PaddingBottom>
        </Style>
        <ZIndex>3</ZIndex>
        <CanGrow>true</CanGrow>
        <Left>2.25in</Left>
        <Height>0.375in</Height>
        <Value>=CDate(Parameters!Start_Date.Value).ToShortDateString + " - " + CDate(Parameters!End_Date.Value).ToShortDateString</Value>
      </Textbox>
      <Textbox Name="textbox3">
        <Width>5.125in</Width>
        <Style>
          <Color>SteelBlue</Color>
          <FontFamily>Tahoma</FontFamily>
          <FontSize>18pt</FontSize>
          <FontWeight>700</FontWeight>
          <TextAlign>Center</TextAlign>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
          <PaddingTop>2pt</PaddingTop>
          <PaddingBottom>2pt</PaddingBottom>
        </Style>
        <ZIndex>2</ZIndex>
        <CanGrow>true</CanGrow>
        <Left>2.25in</Left>
        <Height>0.375in</Height>
        <Value>Weekly Purchases and Sales Summary</Value>
      </Textbox>
      <Textbox Name="rptPageNumber">
        <Top>0.125in</Top>
        <Style>
          <FontFamily>Tahoa</FontFamily>
          <TextAlign>Right</TextAlign>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
          <PaddingTop>2pt</PaddingTop>
          <PaddingBottom>2pt</PaddingBottom>
        </Style>
        <ZIndex>1</ZIndex>
        <CanGrow>true</CanGrow>
        <Left>7.375in</Left>
        <Height>0.25in</Height>
        <Value>="Page " &amp; Globals!PageNumber &amp; " of " &amp; Globals!TotalPages</Value>
      </Textbox>
      <Textbox Name="rptPrintDate">
        <Top>0.125in</Top>
        <Width>2.25in</Width>
        <Style>
          <FontFamily>Tahoma</FontFamily>
          <TextAlign>Center</TextAlign>
          <PaddingLeft>2pt</PaddingLeft>
          <PaddingRight>2pt</PaddingRight>
          <PaddingTop>2pt</PaddingTop>
          <PaddingBottom>2pt</PaddingBottom>
        </Style>
        <CanGrow>true</CanGrow>
        <Height>0.25in</Height>
        <Value>="Report Run: " &amp; FormatDateTime(Now)</Value>
      </Textbox>
    </ReportItems>
    <Height>0.875in</Height>
    <PrintOnLastPage>true</PrintOnLastPage>
  </PageHeader>
  <BottomMargin>0.25in</BottomMargin>
  <rd:ReportID>efc4be83-8eb3-4d5b-b738-d3e3c680a021</rd:ReportID>
  <PageWidth>14in</PageWidth>
  <DataSets>
    <DataSet Name="WeeklyPurchaseandSalesSummary">
      <Fields>
        <Field Name="SubTeam">
          <DataField>Subteam</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="Pur">
          <DataField>Pur</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Sal">
          <DataField>Sal</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="InvChg">
          <DataField>InvChg</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Marg">
          <DataField>Marg</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="MargPct">
          <DataField>MargPct</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
      </Fields>
      <Query>
        <DataSourceName>ItemCatalog</DataSourceName>
        <CommandText>DECLARE @tblInvChgTemp TABLE (tmpField varchar(50))
DECLARE @tblInvChg TABLE (SubTeam_No int, InvChg float)
DECLARE @tblWklyPurSales TABLE (SubTeam char(10),Purchases decimal(9,2),Sales decimal(9,2),InvChg decimal(9,2))

INSERT INTO @tblInvChgTemp
	SELECT Key_Value FROM dbo.fn_ParseStringList(@InvChg,'|')

INSERT INTO @tblInvChg
	SELECT SUBSTRING(tmpField,1,CHARINDEX('^',tmpField)-1),
		   SUBSTRING(tmpField,CHARINDEX('^',tmpField)+1,LEN(tmpField))
	FROM @tblInvChgTemp

INSERT INTO @tblWklyPurSales (SubTeam, InvChg)
	SELECT S.SubTeam_no,i.InvChg
	FROM SubTeam s
	JOIN @tblInvChg i on i.SubTeam_No = s.SubTeam_No
	WHERE exedistributed = 1

/*
Tom Lux
2009-07-24
Bug 9854
Changed (in two places) comparison with @end_date to be strict less-than and added one day to @end_date so that
data for the end date specified would be included in the calculations.
Also set report param types for vendor ID and dates to int and datetime (they were strings).
*/

insert into @tblWklyPurSales (SubTeam, Purchases, Sales)
	select i.SubTeam_No, '0', sum (oi.ReceivedItemCost)
	 from Item i, OrderItem oi, OrderHeader oh
	 where	oh.Vendor_ID = @DC_Vendor_Id
			and oh.OrderHeader_ID = oi.OrderHeader_ID
			and i.Item_Key = oi.Item_Key
			and oi.DateReceived &gt;= @Start_Date
			and oi.DateReceived &lt; dateadd(day, 1, @End_Date) -- This assumes the date coming in is a pure date value (time = 00:00:00).
	 group by i.SubTeam_No

insert into @tblWklyPurSales (SubTeam, Purchases, Sales)
	select i.SubTeam_No, sum(oi.ReceivedItemCost), '0'
	from Item i, OrderItem oi, OrderHeader oh
	where oh.PurchaseLocation_ID = @DC_Vendor_Id
		  and oh.OrderHeader_ID = oi.OrderHeader_ID
		  and i.Item_Key = oi.Item_Key
		  and oi.DateReceived &gt;= @Start_Date
		  and oi.DateReceived &lt; dateadd(day, 1, @End_Date) -- This assumes the date coming in is a pure date value (time = 00:00:00).
	group by i.SubTeam_No

select Subteam, sum(Purchases) as Pur, sum(Sales) as Sal, sum(InvChg) as InvChg,
	   (sum(Sales) - sum(Purchases) + sum(InvChg)) as Marg,
	   ((sum(Sales) - sum(Purchases) + sum(InvChg)) / sum(Sales) ) as MargPct
from @tblWklyPurSales
group by SubTeam
having sum(purchases) &gt; 0
order by SubTeam</CommandText>
        <QueryParameters>
          <QueryParameter Name="@InvChg">
            <Value>=Parameters!InvChg.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@DC_Vendor_Id">
            <Value>=Parameters!DC_Vendor_Id.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@Start_Date">
            <Value>=Parameters!Start_Date.Value</Value>
          </QueryParameter>
          <QueryParameter Name="@End_Date">
            <Value>=Parameters!End_Date.Value</Value>
          </QueryParameter>
        </QueryParameters>
        <rd:UseGenericDesigner>true</rd:UseGenericDesigner>
      </Query>
    </DataSet>
  </DataSets>
  <Code />
  <Width>8.375in</Width>
  <Body>
    <ReportItems>
      <Table Name="table1">
        <DataSetName>WeeklyPurchaseandSalesSummary</DataSetName>
        <Top>0.25in</Top>
        <Width>7.375in</Width>
        <Details>
          <TableRows>
            <TableRow>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox2">
                      <rd:DefaultName>textbox2</rd:DefaultName>
                      <Style>
                        <BorderColor>
                          <Default>LightGrey</Default>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>5</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>=Fields!SubTeam.Value</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox4">
                      <rd:DefaultName>textbox4</rd:DefaultName>
                      <Style>
                        <BorderColor>
                          <Default>LightGrey</Default>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>4</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>=FormatCurrency(Fields!Pur.Value)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox12">
                      <rd:DefaultName>textbox12</rd:DefaultName>
                      <Style>
                        <BorderColor>
                          <Default>LightGrey</Default>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>3</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>=FormatCurrency(Fields!Sal.Value)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox5">
                      <rd:DefaultName>textbox5</rd:DefaultName>
                      <Style>
                        <BorderColor>
                          <Default>LightGrey</Default>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>2</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>=FormatCurrency(Fields!InvChg.Value)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox8">
                      <rd:DefaultName>textbox8</rd:DefaultName>
                      <Style>
                        <BorderColor>
                          <Default>LightGrey</Default>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>1</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>=FormatCurrency(Fields!Marg.Value)</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox9">
                      <rd:DefaultName>textbox9</rd:DefaultName>
                      <Style>
                        <BorderColor>
                          <Default>LightGrey</Default>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <CanGrow>true</CanGrow>
                      <Value>=CStr(Round(Fields!MargPct.Value,2)) + " %"</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
              <Height>0.25in</Height>
            </TableRow>
          </TableRows>
        </Details>
        <Style>
          <BorderStyle>
            <Default>Solid</Default>
          </BorderStyle>
        </Style>
        <Header>
          <TableRows>
            <TableRow>
              <TableCells>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox28">
                      <Style>
                        <Color>White</Color>
                        <BackgroundColor>SteelBlue</BackgroundColor>
                        <BorderColor>
                          <Default>White</Default>
                          <Top>LightGrey</Top>
                          <Bottom>LightGrey</Bottom>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                          <Left>Solid</Left>
                          <Right>Solid</Right>
                          <Top>Solid</Top>
                          <Bottom>Solid</Bottom>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <FontSize>9pt</FontSize>
                        <FontWeight>700</FontWeight>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>11</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>SubTeam</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox29">
                      <Style>
                        <Color>White</Color>
                        <BackgroundColor>SteelBlue</BackgroundColor>
                        <BorderColor>
                          <Default>White</Default>
                          <Top>LightGrey</Top>
                          <Bottom>LightGrey</Bottom>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                          <Left>Solid</Left>
                          <Right>Solid</Right>
                          <Top>Solid</Top>
                          <Bottom>Solid</Bottom>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <FontSize>9pt</FontSize>
                        <FontWeight>700</FontWeight>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>10</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>Purchases</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox30">
                      <Style>
                        <Color>White</Color>
                        <BackgroundColor>SteelBlue</BackgroundColor>
                        <BorderColor>
                          <Default>White</Default>
                          <Top>LightGrey</Top>
                          <Bottom>LightGrey</Bottom>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                          <Left>Solid</Left>
                          <Right>Solid</Right>
                          <Top>Solid</Top>
                          <Bottom>Solid</Bottom>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <FontSize>9pt</FontSize>
                        <FontWeight>700</FontWeight>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>9</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>Sales</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox32">
                      <Style>
                        <Color>White</Color>
                        <BackgroundColor>SteelBlue</BackgroundColor>
                        <BorderColor>
                          <Default>White</Default>
                          <Top>LightGrey</Top>
                          <Bottom>LightGrey</Bottom>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                          <Left>Solid</Left>
                          <Right>Solid</Right>
                          <Top>Solid</Top>
                          <Bottom>Solid</Bottom>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <FontSize>9pt</FontSize>
                        <FontWeight>700</FontWeight>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>8</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>Inventory Change</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox33">
                      <Style>
                        <Color>White</Color>
                        <BackgroundColor>SteelBlue</BackgroundColor>
                        <BorderColor>
                          <Default>White</Default>
                          <Top>LightGrey</Top>
                          <Bottom>LightGrey</Bottom>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                          <Left>Solid</Left>
                          <Right>Solid</Right>
                          <Top>Solid</Top>
                          <Bottom>Solid</Bottom>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <FontSize>9pt</FontSize>
                        <FontWeight>700</FontWeight>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>7</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>Margin</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
                <TableCell>
                  <ReportItems>
                    <Textbox Name="textbox34">
                      <Style>
                        <Color>White</Color>
                        <BackgroundColor>SteelBlue</BackgroundColor>
                        <BorderColor>
                          <Default>White</Default>
                          <Top>LightGrey</Top>
                          <Bottom>LightGrey</Bottom>
                        </BorderColor>
                        <BorderStyle>
                          <Default>Solid</Default>
                          <Left>Solid</Left>
                          <Right>Solid</Right>
                          <Top>Solid</Top>
                          <Bottom>Solid</Bottom>
                        </BorderStyle>
                        <FontFamily>tahoma</FontFamily>
                        <FontSize>9pt</FontSize>
                        <FontWeight>700</FontWeight>
                        <TextAlign>Center</TextAlign>
                        <PaddingLeft>2pt</PaddingLeft>
                        <PaddingRight>2pt</PaddingRight>
                        <PaddingTop>2pt</PaddingTop>
                        <PaddingBottom>2pt</PaddingBottom>
                      </Style>
                      <ZIndex>6</ZIndex>
                      <CanGrow>true</CanGrow>
                      <Value>Margin Percent</Value>
                    </Textbox>
                  </ReportItems>
                </TableCell>
              </TableCells>
              <Height>0.25in</Height>
            </TableRow>
          </TableRows>
        </Header>
        <TableColumns>
          <TableColumn>
            <Width>1in</Width>
          </TableColumn>
          <TableColumn>
            <Width>1.5in</Width>
          </TableColumn>
          <TableColumn>
            <Width>1.125in</Width>
          </TableColumn>
          <TableColumn>
            <Width>1.375in</Width>
          </TableColumn>
          <TableColumn>
            <Width>1.125in</Width>
          </TableColumn>
          <TableColumn>
            <Width>1.25in</Width>
          </TableColumn>
        </TableColumns>
        <Height>0.5in</Height>
        <Left>0.625in</Left>
      </Table>
    </ReportItems>
    <Height>1.25in</Height>
  </Body>
  <Language>en-US</Language>
  <TopMargin>0.25in</TopMargin>
  <PageHeight>8.5in</PageHeight>
</Report>